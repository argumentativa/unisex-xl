<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASCII Visualizer Test - UNISEX XL</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: #000;
            color: #0f0;
            overflow: hidden;
        }

        .container {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        .header {
            background: #111;
            padding: 20px;
            border-bottom: 2px solid #0f0;
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 10px;
        }

        .controls {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .control-group label {
            font-size: 12px;
            color: #0ff;
        }

        select, button {
            background: #000;
            color: #0f0;
            border: 1px solid #0f0;
            padding: 8px 12px;
            font-family: 'Courier New', monospace;
            cursor: pointer;
        }

        select:hover, button:hover {
            background: #0f0;
            color: #000;
        }

        .play-btn {
            background: #0f0;
            color: #000;
            font-weight: bold;
            padding: 10px 20px;
            font-size: 14px;
        }

        .play-btn:hover {
            background: #0ff;
        }

        .visualizer-container {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #000;
        }

        #ascii-visualizer {
            border: 1px solid #0f0;
        }

        .status {
            background: #111;
            padding: 10px 20px;
            border-top: 1px solid #0f0;
            font-size: 12px;
            display: flex;
            justify-content: space-between;
        }

        .status span {
            color: #0ff;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸŽµ ASCII VISUALIZER TEST</h1>
            <p>Audio-Reactive ASCII Art with Tone.js + p5.js</p>
            
            <div class="controls">
                <button id="playBtn" class="play-btn">â–¶ START AUDIO</button>
                
                <div class="control-group">
                    <label>Visualization Mode:</label>
                    <select id="modeSelect">
                        <option value="reactive">Reactive Grid</option>
                        <option value="grid">Static Grid</option>
                        <option value="waveform">Waveform</option>
                        <option value="circular">Circular</option>
                    </select>
                </div>

                <div class="control-group">
                    <label>Color Mode:</label>
                    <select id="colorSelect">
                        <option value="color">Rainbow</option>
                        <option value="mono">Monochrome</option>
                        <option value="hue">Hue Cycle</option>
                        <option value="energy">Energy</option>
                    </select>
                </div>

                <div class="control-group">
                    <label>ASCII Density:</label>
                    <select id="densitySelect">
                        <option value="low">Low</option>
                        <option value="medium" selected>Medium</option>
                        <option value="high">High</option>
                    </select>
                </div>

                <div class="control-group">
                    <label>Test Pattern:</label>
                    <select id="patternSelect">
                        <option value="techno">Techno Beat</option>
                        <option value="bass">Bass Line</option>
                        <option value="melody">Melody</option>
                        <option value="noise">Noise</option>
                    </select>
                </div>

                <button id="triggerBtn">Trigger Pattern</button>
            </div>
        </div>

        <div class="visualizer-container">
            <div id="ascii-visualizer"></div>
        </div>

        <div class="status">
            <span id="statusText">Status: Ready</span>
            <span id="fpsText">FPS: 0</span>
        </div>
    </div>

    <script type="module">
        import * as Tone from 'tone';
        import { AsciiVisualizer } from './src/components/ascii-visualizer.ts';

        // Create visualizer
        const container = document.getElementById('ascii-visualizer');
        const visualizer = new AsciiVisualizer(container, {
            width: window.innerWidth,
            height: window.innerHeight - 200,
            mode: 'reactive',
            colorMode: 'color',
            asciiDensity: 'medium'
        });

        // Create Tone.js components
        const analyzer = new Tone.Analyser('waveform', 512);
        Tone.getDestination().connect(analyzer);
        visualizer.setAnalyzer(analyzer);

        // Create test instruments
        const synth = new Tone.PolySynth(Tone.Synth).toDestination();
        const bass = new Tone.MonoSynth({
            oscillator: { type: 'sawtooth' }
        }).toDestination();
        const noiseSynth = new Tone.NoiseSynth().toDestination(); // Renamed to avoid p5.js conflict

        // Test patterns
        const patterns = {
            techno: () => {
                const kick = new Tone.Loop((time) => {
                    synth.triggerAttackRelease('C1', '8n', time);
                }, '4n').start(0);
                
                const hat = new Tone.Loop((time) => {
                    noiseSynth.triggerAttackRelease('8n', time);
                }, '8n').start(0);
            },
            bass: () => {
                const bassline = new Tone.Pattern((time, note) => {
                    bass.triggerAttackRelease(note, '8n', time);
                }, ['C2', 'E2', 'G2', 'A2'], 'upDown').start(0);
            },
            melody: () => {
                const melody = new Tone.Sequence((time, note) => {
                    synth.triggerAttackRelease(note, '16n', time);
                }, ['C4', 'E4', 'G4', 'B4', 'A4', 'F4', 'D4', 'C4'], '8n').start(0);
            },
            noise: () => {
                const noiseLoop = new Tone.Loop((time) => {
                    noiseSynth.triggerAttackRelease('16n', time);
                }, '16n').start(0);
            }
        };

        // UI Controls
        const playBtn = document.getElementById('playBtn');
        const modeSelect = document.getElementById('modeSelect');
        const colorSelect = document.getElementById('colorSelect');
        const densitySelect = document.getElementById('densitySelect');
        const patternSelect = document.getElementById('patternSelect');
        const triggerBtn = document.getElementById('triggerBtn');
        const statusText = document.getElementById('statusText');
        const fpsText = document.getElementById('fpsText');

        let isPlaying = false;
        let lastTime = Date.now();
        let frameCount = 0;

        // FPS counter
        setInterval(() => {
            const fps = Math.round(frameCount * 1000 / (Date.now() - lastTime));
            fpsText.textContent = `FPS: ${fps}`;
            frameCount = 0;
            lastTime = Date.now();
        }, 1000);

        setInterval(() => frameCount++, 16);

        playBtn.addEventListener('click', async () => {
            await Tone.start();
            
            if (!isPlaying) {
                Tone.Transport.start();
                playBtn.textContent = 'â¸ PAUSE';
                statusText.textContent = 'Status: Playing';
                isPlaying = true;
            } else {
                Tone.Transport.pause();
                playBtn.textContent = 'â–¶ RESUME';
                statusText.textContent = 'Status: Paused';
                isPlaying = false;
            }
        });

        modeSelect.addEventListener('change', (e) => {
            visualizer.setMode(e.target.value);
            statusText.textContent = `Mode: ${e.target.value}`;
        });

        colorSelect.addEventListener('change', (e) => {
            visualizer.setColorMode(e.target.value);
            statusText.textContent = `Color: ${e.target.value}`;
        });

        densitySelect.addEventListener('change', (e) => {
            visualizer.updateConfig({ asciiDensity: e.target.value });
            statusText.textContent = `Density: ${e.target.value}`;
        });

        triggerBtn.addEventListener('click', async () => {
            await Tone.start();
            Tone.Transport.cancel(); // Clear all scheduled events
            
            const pattern = patternSelect.value;
            patterns[pattern]();
            
            Tone.Transport.start();
            playBtn.textContent = 'â¸ PAUSE';
            statusText.textContent = `Playing: ${pattern}`;
            isPlaying = true;
        });

        // Window resize
        window.addEventListener('resize', () => {
            visualizer.updateConfig({
                width: window.innerWidth,
                height: window.innerHeight - 200
            });
        });

        // Initial status
        statusText.textContent = 'Status: Ready - Click START AUDIO';
    </script>
</body>
</html>

