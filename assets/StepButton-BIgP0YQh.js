const o=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],l=["#FFCBA4","#E2725B","#FBCEB1","#F4D03F","#7FCDCD","#93E9BE","#4A9B9B","#63B3B3","#DCAE96","#B2C9AB","#C5B4E3","#F8EDD3"];class p{element;stepIndex;stepState;colorConfig;callbacks;interactionLevel=0;rowActivity=0;hue;constructor(t,e,s,i){this.stepIndex=t,this.stepState={...e},this.colorConfig=s,this.callbacks=i,s.mode==="hue"?this.hue=s.hue:this.hue=this.extractHueFromHex(s.character.baseColor),this.element=document.createElement("button"),this.element.className=this.getButtonClassName(),this.element.setAttribute("data-step",t.toString()),this.element.setAttribute("aria-label",`Step ${t+1}`),this.element.addEventListener("click",()=>{this.handleClick()}),this.updateState()}handleClick(){let t=this.stepState.noteIndex+1;t>11&&(t=-1);const e=t>=0;this.stepState={isActive:e,noteIndex:t,pressCount:this.stepState.pressCount+1},this.colorConfig.mode==="hue"&&e&&(this.hue=t*30),this.updateState(),this.callbacks.onStateChange(this.stepIndex,{...this.stepState}),e&&this.callbacks.onPlayPreview&&this.callbacks.onPlayPreview(t)}getButtonClassName(){return this.colorConfig.mode==="character"?"step-button character-mode":"step-button"}extractHueFromHex(t){const e=parseInt(t.slice(1,3),16)/255,s=parseInt(t.slice(3,5),16)/255,i=parseInt(t.slice(5,7),16)/255,n=Math.max(e,s,i),c=Math.min(e,s,i);let a=0;if(n!==c){const r=n-c;switch(n){case e:a=((s-i)/r+(s<i?6:0))/6;break;case s:a=((i-e)/r+2)/6;break;case i:a=((e-s)/r+4)/6;break}}return Math.round(a*360)}getElement(){return this.element}setStepState(t){this.stepState={...t},this.updateState()}getStepState(){return{...this.stepState}}getNoteName(){return o[this.stepState.noteIndex]||"C"}setCurrentStep(t){this.element.classList.toggle("current-step",t)}setInteractionLevel(t,e=0){this.interactionLevel=t,this.rowActivity=e,this.updateState()}updateState(){this.element.classList.remove("active","inactive"),this.stepState.isActive?this.element.classList.add("active"):this.element.classList.add("inactive"),this.colorConfig.mode==="character"?this.applyCharacterColor():this.applyHueColor(),this.updateContent(),this.stepState.isActive?this.element.classList.add("glow-active"):this.element.classList.remove("glow-active")}applyHueColor(){if(!this.stepState.isActive||this.stepState.noteIndex===-1){this.element.style.backgroundColor="",this.element.style.color="";return}const t=l[this.stepState.noteIndex];this.element.style.backgroundColor=t,this.element.style.color="#333333"}applyCharacterColor(){if(this.colorConfig.mode!=="character")return;if(!this.stepState.isActive||this.stepState.noteIndex===-1){this.element.style.backgroundColor="",this.element.style.color="";return}const t=l[this.stepState.noteIndex];this.element.style.backgroundColor=t,this.element.style.color="#333333"}calculateSaturation(){return this.stepState.isActive?100:0}calculateLightness(){if(!this.stepState.isActive)return 20;let t=55;switch(this.interactionLevel){case 0:return 55;case 1:t=58;break;case 2:t=62;break;case 3:t=66;break;case 4:t=70;break;case 5:t=75;break;default:t=55}const e=this.rowActivity*15;return Math.min(t+e,90)}updateContent(){if(this.colorConfig.mode==="character")this.renderCharacterContent();else{this.element.innerHTML="";const t=this.getNoteName();this.element.setAttribute("aria-label",`Step ${this.stepIndex+1} - ${t} (${this.stepState.pressCount} presses)`)}}renderCharacterContent(){if(this.colorConfig.mode!=="character")return;const t=this.colorConfig.character;if(!this.stepState.isActive||this.stepState.noteIndex===-1){this.element.innerHTML="",this.element.setAttribute("aria-label",`Step ${this.stepIndex+1} - ${t.name} (off)`);return}const e=document.createElement("div");e.className="step-note-label",t.canPitch&&this.stepState.noteIndex>=0?e.textContent=o[this.stepState.noteIndex]:e.textContent="♪",this.element.innerHTML="",this.element.appendChild(e);const s=t.canPitch?o[this.stepState.noteIndex]:"♪";this.element.setAttribute("aria-label",`Step ${this.stepIndex+1} - ${t.name} - ${s}`)}}export{p as S};
