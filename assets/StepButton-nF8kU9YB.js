const o=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],h=["#FFCBA4","#E2725B","#FBCEB1","#F4D03F","#7FCDCD","#93E9BE","#4A9B9B","#63B3B3","#DCAE96","#B2C9AB","#C5B4E3","#F8EDD3"];class d{element;stepIndex;stepState;colorConfig;callbacks;interactionLevel=0;rowActivity=0;hue;longPressTimer=null;longPressDuration=500;isLongPress=!1;touchHandled=!1;constructor(e,t,i,n){this.stepIndex=e,this.stepState={...t},this.colorConfig=i,this.callbacks=n,i.mode==="hue"?this.hue=i.hue:this.hue=this.extractHueFromHex(i.character.baseColor),this.element=document.createElement("button"),this.element.className=this.getButtonClassName(),this.element.setAttribute("data-step",e.toString()),this.element.setAttribute("aria-label",`Step ${e+1}`),this.element.addEventListener("click",s=>{this.touchHandled||this.handleClick(),this.touchHandled=!1}),this.element.addEventListener("touchstart",s=>{this.handleLongPressStart(s)}),this.element.addEventListener("touchend",s=>{this.handleLongPressEnd(s)}),this.element.addEventListener("touchcancel",()=>{this.clearLongPressTimer()}),this.element.addEventListener("mousedown",s=>{this.handleLongPressStart(s)}),this.element.addEventListener("mouseup",s=>{this.handleLongPressEnd(s)}),this.element.addEventListener("mouseleave",()=>{this.clearLongPressTimer()}),this.element.addEventListener("contextmenu",s=>{s.preventDefault()}),this.updateState()}handleClick(){if(this.isLongPress){this.isLongPress=!1;return}let e=this.stepState.noteIndex+1;e>11&&(e=-1);const t=e>=0;this.stepState={isActive:t,noteIndex:e,pressCount:this.stepState.pressCount+1},this.colorConfig.mode==="hue"&&t&&(this.hue=e*30),this.updateState(),this.callbacks.onStateChange(this.stepIndex,{...this.stepState}),t&&this.callbacks.onPlayPreview&&this.callbacks.onPlayPreview(e)}handleLongPressStart(e){this.clearLongPressTimer(),this.isLongPress=!1,this.touchHandled=!1,e.type==="touchstart"&&e.preventDefault(),this.longPressTimer=window.setTimeout(()=>{this.handleLongPress()},this.longPressDuration)}handleLongPressEnd(e){const t=this.longPressTimer!==null;this.longPressTimer!==null&&this.clearLongPressTimer(),e.type==="touchend"&&e.preventDefault(),t&&!this.isLongPress&&e.type==="touchend"&&(this.touchHandled=!0,this.handleClick())}clearLongPressTimer(){this.longPressTimer!==null&&(clearTimeout(this.longPressTimer),this.longPressTimer=null)}handleLongPress(){this.clearLongPressTimer(),this.isLongPress=!0,this.stepState={isActive:!1,noteIndex:-1,pressCount:this.stepState.pressCount+1},this.updateState(),this.callbacks.onStateChange(this.stepIndex,{...this.stepState})}getButtonClassName(){return this.colorConfig.mode==="character"?"step-button character-mode":"step-button"}extractHueFromHex(e){const t=parseInt(e.slice(1,3),16)/255,i=parseInt(e.slice(3,5),16)/255,n=parseInt(e.slice(5,7),16)/255,s=Math.max(t,i,n),l=Math.min(t,i,n);let a=0;if(s!==l){const r=s-l;switch(s){case t:a=((i-n)/r+(i<n?6:0))/6;break;case i:a=((n-t)/r+2)/6;break;case n:a=((t-i)/r+4)/6;break}}return Math.round(a*360)}getElement(){return this.element}setStepState(e){this.stepState={...e},this.updateState()}getStepState(){return{...this.stepState}}getNoteName(){return o[this.stepState.noteIndex]||"C"}setCurrentStep(e){this.element.classList.toggle("current-step",e)}setInteractionLevel(e,t=0){this.interactionLevel=e,this.rowActivity=t,this.updateState()}updateState(){this.element.classList.remove("active","inactive"),this.stepState.isActive?this.element.classList.add("active"):this.element.classList.add("inactive"),this.colorConfig.mode==="character"?this.applyCharacterColor():this.applyHueColor(),this.updateContent(),this.stepState.isActive?this.element.classList.add("glow-active"):this.element.classList.remove("glow-active")}applyHueColor(){if(!this.stepState.isActive||this.stepState.noteIndex===-1){this.element.style.backgroundColor="",this.element.style.color="";return}const e=h[this.stepState.noteIndex];this.element.style.backgroundColor=e,this.element.style.color="#333333"}applyCharacterColor(){if(this.colorConfig.mode!=="character")return;if(!this.stepState.isActive||this.stepState.noteIndex===-1){this.element.style.backgroundColor="",this.element.style.color="";return}const e=h[this.stepState.noteIndex];this.element.style.backgroundColor=e,this.element.style.color="#333333"}calculateSaturation(){return this.stepState.isActive?100:0}calculateLightness(){if(!this.stepState.isActive)return 20;let e=55;switch(this.interactionLevel){case 0:return 55;case 1:e=58;break;case 2:e=62;break;case 3:e=66;break;case 4:e=70;break;case 5:e=75;break;default:e=55}const t=this.rowActivity*15;return Math.min(e+t,90)}updateContent(){if(this.colorConfig.mode==="character")this.renderCharacterContent();else{this.element.innerHTML="";const e=this.getNoteName();this.element.setAttribute("aria-label",`Step ${this.stepIndex+1} - ${e} (${this.stepState.pressCount} presses)`)}}renderCharacterContent(){if(this.colorConfig.mode!=="character")return;const e=this.colorConfig.character;if(!this.stepState.isActive||this.stepState.noteIndex===-1){this.element.innerHTML="",this.element.setAttribute("aria-label",`Step ${this.stepIndex+1} - ${e.name} (off)`);return}const t=document.createElement("div");t.className="step-note-label",e.canPitch&&this.stepState.noteIndex>=0?t.textContent=o[this.stepState.noteIndex]:t.textContent="♪",this.element.innerHTML="",this.element.appendChild(t);const i=e.canPitch?o[this.stepState.noteIndex]:"♪";this.element.setAttribute("aria-label",`Step ${this.stepIndex+1} - ${e.name} - ${i}`)}}export{d as S};
