import{V as r,f as c,a as n,e as l,b as o,d as u,c as h,R as f,g as m,i as y,B as d,s as p}from"./utils-BOqQI58-.js";class w{instruments;effects;effectChain;masterVolume=null;analyzer=null;initialized=!1;constructor(){this.instruments=new Map,this.effects=new Map,this.effectChain=[]}initializeAudio(){this.initialized||(this.masterVolume=new r(-10),this.analyzer=new c("waveform",256),this.initializeInstruments(),this.initializeEffects(),n.bpm.value=120,this.initialized=!0)}initializeInstruments(){const e=new l(o,{oscillator:{type:"triangle"},envelope:{attack:.005,decay:.1,sustain:.3,release:1}}),s=new u({oscillator:{type:"sawtooth"},envelope:{attack:.01,decay:.2,sustain:.5,release:.8},filterEnvelope:{attack:.01,decay:.1,sustain:.5,release:.5,baseFrequency:200,octaves:2.5}}),t=new h({pitchDecay:.05,octaves:10,oscillator:{type:"sine"},envelope:{attack:.001,decay:.4,sustain:.01,release:1.4,attackCurve:"exponential"}});this.instruments.set("synth",{type:"synth",enabled:!0,volume:-10,instance:e}),this.instruments.set("bass",{type:"bass",enabled:!0,volume:-10,instance:s}),this.instruments.set("drums",{type:"drums",enabled:!0,volume:-10,instance:t})}initializeEffects(){const e=new f({decay:2,wet:.3}),s=new m({delayTime:"8n",feedback:.2,wet:.2}),t=new y({distortion:0,wet:0}),a=new d(4);a.wet.value=0,this.effects.set("reverb",{type:"reverb",value:.3,instance:e}),this.effects.set("delay",{type:"delay",value:.2,instance:s}),this.effects.set("distortion",{type:"distortion",value:0,instance:t}),this.effects.set("bitcrusher",{type:"bitcrusher",value:0,instance:a}),this.effectChain=[t,a,s,e,this.masterVolume,this.analyzer];for(let i=0;i<this.effectChain.length-1;i++)this.effectChain[i].connect(this.effectChain[i+1]);this.analyzer.toDestination(),this.instruments.forEach(i=>{i.instance&&i.instance.connect(this.effectChain[0])})}async start(){await p(),this.initializeAudio()}getInstrument(e){return this.instruments.get(e)}getEffect(e){return this.effects.get(e)}setInstrumentVolume(e,s){const t=this.instruments.get(e);t&&t.instance&&(t.instance.volume.value=s,t.volume=s)}toggleInstrument(e,s){const t=this.instruments.get(e);t&&t.instance&&(t.enabled=s,t.instance.volume.value=s?t.volume:-1/0)}setEffect(e,s){const t=this.effects.get(e);if(!(!t||!t.instance))switch(t.value=s,e){case"reverb":t.instance.wet.value=s;break;case"delay":t.instance.wet.value=s;break;case"distortion":t.instance.wet.value=s;break;case"bitcrusher":t.instance.wet.value=s;break}}setBPM(e){n.bpm.value=e}getBPM(){return n.bpm.value}play(){n.start()}pause(){n.pause()}stop(){n.stop(),n.cancel()}getAnalyzer(){return this.analyzer}getEffectChainInput(){return!this.initialized||this.effectChain.length===0?null:this.effectChain[0]}connectToEffectChain(e){if(!this.initialized||this.effectChain.length===0){e.toDestination();return}e.connect(this.effectChain[0])}getTransport(){return n}dispose(){this.stop(),this.instruments.forEach(e=>{e.instance?.dispose()}),this.effects.forEach(e=>{e.instance?.dispose()}),this.masterVolume?.dispose(),this.analyzer?.dispose()}}export{w as A};
