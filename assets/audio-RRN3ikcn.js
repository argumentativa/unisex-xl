import{V as h,f as l,a,e as f,b as u,d as m,c as d,R as y,g as p,h as v,B as o,s as b}from"./index-D5ZjplQM.js";class g{instruments;effects;effectChain;masterVolume=null;analyzer=null;initialized=!1;constructor(){this.instruments=new Map,this.effects=new Map,this.effectChain=[]}initializeAudio(){this.initialized||(this.masterVolume=new h(-10),this.analyzer=new l("waveform",256),this.initializeInstruments(),this.initializeEffects(),a.bpm.value=120,this.initialized=!0)}initializeInstruments(){const t=new f(u,{oscillator:{type:"triangle"},envelope:{attack:.005,decay:.1,sustain:.3,release:1}}),s=new m({oscillator:{type:"sawtooth"},envelope:{attack:.01,decay:.2,sustain:.5,release:.8},filterEnvelope:{attack:.01,decay:.1,sustain:.5,release:.5,baseFrequency:200,octaves:2.5}}),e=new d({pitchDecay:.05,octaves:10,oscillator:{type:"sine"},envelope:{attack:.001,decay:.4,sustain:.01,release:1.4,attackCurve:"exponential"}});this.instruments.set("synth",{type:"synth",enabled:!0,volume:-10,instance:t}),this.instruments.set("bass",{type:"bass",enabled:!0,volume:-10,instance:s}),this.instruments.set("drums",{type:"drums",enabled:!0,volume:-10,instance:e})}initializeEffects(){const t=new y({decay:2,wet:.3}),s=new p({delayTime:"8n",feedback:.2,wet:.2}),e=new v({distortion:0,wet:0}),i=new o(16);i.wet.value=0,this.effects.set("reverb",{type:"reverb",value:.3,instance:t}),this.effects.set("delay",{type:"delay",value:.2,instance:s}),this.effects.set("distortion",{type:"distortion",value:0,instance:e}),this.effects.set("bitcrusher",{type:"bitcrusher",value:16,instance:i}),this.effectChain=[e,i,s,t,this.masterVolume,this.analyzer];for(let n=0;n<this.effectChain.length-1;n++)this.effectChain[n].connect(this.effectChain[n+1]);this.analyzer.toDestination(),this.instruments.forEach(n=>{n.instance&&n.instance.connect(this.effectChain[0])})}async start(){await b(),this.initializeAudio()}getInstrument(t){return this.instruments.get(t)}getEffect(t){return this.effects.get(t)}setInstrumentVolume(t,s){const e=this.instruments.get(t);e&&e.instance&&(e.instance.volume.value=s,e.volume=s)}toggleInstrument(t,s){const e=this.instruments.get(t);e&&e.instance&&(e.enabled=s,e.instance.volume.value=s?e.volume:-1/0)}setEffect(t,s){const e=this.effects.get(t);if(!(!e||!e.instance))switch(e.value=s,t){case"reverb":e.instance.wet.value=s;break;case"delay":e.instance.wet.value=s;break;case"distortion":e.instance.wet.value=s;break;case"bitcrusher":const i=e.instance,n=this.effectChain.indexOf(i);n>0&&this.effectChain[n-1].disconnect(i),i.disconnect(),i.dispose();const c=new o(Math.round(s));c.wet.value=s<16?1:0,n>0&&this.effectChain[n-1].connect(c),n<this.effectChain.length-1&&c.connect(this.effectChain[n+1]),this.effectChain[n]=c,e.instance=c,this.instruments.forEach(r=>{r.instance&&r.enabled&&(r.instance.disconnect(),r.instance.connect(this.effectChain[0]))});break}}setBPM(t){a.bpm.value=t}getBPM(){return a.bpm.value}play(){a.start()}pause(){a.pause()}stop(){a.stop(),a.cancel()}getAnalyzer(){return this.analyzer}getTransport(){return a}dispose(){this.stop(),this.instruments.forEach(t=>{t.instance?.dispose()}),this.effects.forEach(t=>{t.instance?.dispose()}),this.masterVolume?.dispose(),this.analyzer?.dispose()}}export{g as A};
