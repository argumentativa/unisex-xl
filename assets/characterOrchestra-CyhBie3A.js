import{b as f,e as A,d as I,F as k,P as w,M as P,N as x,c as B,S as M,a as p,i as R,s as N}from"./index-D5ZjplQM.js";function T(o){switch(o.type){case"membrane":return new B({pitchDecay:.05,octaves:10,oscillator:{type:"sine"},envelope:{attack:.001,decay:.4,sustain:.01,release:1.4,attackCurve:"exponential"}});case"noise":return new x({noise:{type:"white"},envelope:{attack:.001,decay:.2,sustain:0,release:.2}});case"metal":return new P({envelope:{attack:.001,decay:.1,release:.01},harmonicity:5.1,modulationIndex:32,resonance:4e3,octaves:1.5});case"synth":return new f({oscillator:{type:"triangle"},envelope:{attack:.005,decay:.1,sustain:.3,release:1}});case"pluck":return new w({attackNoise:1,dampening:4e3,resonance:.7});case"fm":return new k({harmonicity:3,modulationIndex:10,detune:0,oscillator:{type:"sine"},envelope:{attack:.01,decay:.01,sustain:1,release:.5},modulation:{type:"square"},modulationEnvelope:{attack:.5,decay:0,sustain:1,release:.5}});case"mono":return new I({oscillator:{type:"square"},envelope:{attack:.1,decay:.3,sustain:.4,release:.8},filterEnvelope:{attack:.001,decay:.01,sustain:.5,baseFrequency:200,octaves:2.6}});case"poly":return new A(f,{oscillator:{type:"triangle"},envelope:{attack:.02,decay:.1,sustain:.3,release:1}});default:return new f}}const q=[{name:"Boom the Elephant",emoji:"ðŸ˜",baseColor:"#ff6b6b",type:"membrane",octave:1,canPitch:!1},{name:"Snap the Squirrel",emoji:"ðŸ¿ï¸",baseColor:"#4ecdc4",type:"noise",octave:4,canPitch:!1},{name:"Shimmer the Bird",emoji:"ðŸ¦",baseColor:"#ffe66d",type:"metal",octave:4,canPitch:!1},{name:"Melody the Fox",emoji:"ðŸ¦Š",baseColor:"#f38181",type:"synth",octave:4,canPitch:!0},{name:"Pluck the Rabbit",emoji:"ðŸ°",baseColor:"#95e1d3",type:"pluck",octave:4,canPitch:!0},{name:"Glow the Firefly",emoji:"âœ¨",baseColor:"#aa96da",type:"fm",octave:5,canPitch:!0},{name:"Rumble the Bear",emoji:"ðŸ»",baseColor:"#a8e6cf",type:"mono",octave:2,canPitch:!0},{name:"Chorus the Birds",emoji:"ðŸ¦â€â¬›",baseColor:"#fcbad3",type:"poly",octave:4,canPitch:!0}],v=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];class L{element;stepIndex;stepState;character;constructor(t,e,n,a){this.stepIndex=t,this.stepState={...e},this.character=n,this.element=document.createElement("button"),this.element.className="character-step-button",this.element.setAttribute("data-step",t.toString()),this.element.addEventListener("click",()=>{a(t)}),this.updateAppearance()}getElement(){return this.element}setStepState(t){this.stepState={...t},this.updateAppearance()}setCurrentStep(t){this.element.classList.toggle("current-step",t)}updateAppearance(){this.element.classList.remove("active","inactive"),this.stepState.isActive?this.element.classList.add("active"):this.element.classList.add("inactive");const t=this.calculateColor();this.element.style.backgroundColor=t.backgroundColor,this.element.style.borderColor=t.borderColor,this.element.style.color=t.textColor,this.updateContent()}calculateColor(){const t=this.character.baseColor,e=parseInt(t.slice(1,3),16),n=parseInt(t.slice(3,5),16),a=parseInt(t.slice(5,7),16);if(!this.stepState.isActive||this.stepState.noteIndex===-1)return{backgroundColor:"rgba(42, 42, 46, 0.3)",borderColor:"rgba(255, 255, 255, 0.3)",textColor:"rgba(255, 255, 255, 0.3)"};if(this.character.canPitch){const s=25+this.stepState.noteIndex/11*50,r=this.rgbToHsl(e,n,a);return{backgroundColor:`hsl(${r.h}, ${r.s}%, ${s}%)`,borderColor:"#ffffff",textColor:"#ffffff"}}else{const s=this.rgbToHsl(e,n,a);return{backgroundColor:`hsl(${s.h}, ${s.s}%, 50%)`,borderColor:"#ffffff",textColor:"#ffffff"}}}rgbToHsl(t,e,n){t/=255,e/=255,n/=255;const a=Math.max(t,e,n),s=Math.min(t,e,n);let r=0,h=0;const c=(a+s)/2;if(a!==s){const i=a-s;switch(h=c>.5?i/(2-a-s):i/(a+s),a){case t:r=((e-n)/i+(e<n?6:0))/6;break;case e:r=((n-t)/i+2)/6;break;case n:r=((t-e)/i+4)/6;break}}return{h:Math.round(r*360),s:Math.round(h*100),l:Math.round(c*100)}}updateContent(){if(!this.stepState.isActive||this.stepState.noteIndex===-1){this.element.innerHTML="",this.element.setAttribute("aria-label",`Step ${this.stepIndex+1} - ${this.character.name} (off)`);return}const t=document.createElement("div");t.className="step-emoji",t.textContent=this.character.emoji;const e=document.createElement("div");e.className="step-note-label",this.character.canPitch&&this.stepState.noteIndex>=0?e.textContent=v[this.stepState.noteIndex]:e.textContent="â™ª",this.element.innerHTML="",this.element.appendChild(t),this.element.appendChild(e);const n=this.character.canPitch?v[this.stepState.noteIndex]:"â™ª";this.element.setAttribute("aria-label",`Step ${this.stepIndex+1} - ${this.character.name} - ${n}`)}}class ${element;character;pattern;stepButtons;currentStep=-1;emotionalState="sleepy";scrollContainer=null;constructor(t,e,n,a){this.character=t,this.pattern=e,this.stepButtons=[],this.element=document.createElement("div"),this.element.className="character-row",this.element.setAttribute("data-character",t.name);const s=document.createElement("div");s.className="character-info";const r=document.createElement("div");r.className="character-avatar",r.setAttribute("data-emotional-state",this.emotionalState),r.style.borderColor=t.baseColor,r.textContent=t.emoji,s.appendChild(r);const h=document.createElement("div");h.className="character-name",h.textContent=t.name,s.appendChild(h);const c=document.createElement("div");c.className="character-status",c.textContent=this.getStatusEmoji(),s.appendChild(c),this.element.appendChild(s);const i=document.createElement("div");i.className="steps-scroll-wrapper";const l=document.createElement("div");l.className=`steps-scroll-container scroll-${this.getScrollDirection()}`;for(let d=0;d<8;d++){const y=d%4,g=new L(y,e.steps[y],t,n);this.stepButtons.push(g),l.appendChild(g.getElement())}i.appendChild(l),this.element.appendChild(i),this.scrollContainer=l}getElement(){return this.element}getScrollDirection(){return this.pattern.characterIndex%2===0?"right-to-left":"left-to-right"}updateStep(t,e){t>=0&&t<4&&(t<this.stepButtons.length&&this.stepButtons[t].setStepState(e),t+4<this.stepButtons.length&&this.stepButtons[t+4].setStepState(e))}updateCurrentStep(t){this.currentStep>=0&&this.currentStep<4&&(this.currentStep<this.stepButtons.length&&this.stepButtons[this.currentStep].setCurrentStep(!1),this.currentStep+4<this.stepButtons.length&&this.stepButtons[this.currentStep+4].setCurrentStep(!1)),this.currentStep=t,this.currentStep>=0&&this.currentStep<4&&(this.currentStep<this.stepButtons.length&&this.stepButtons[this.currentStep].setCurrentStep(!0),this.currentStep+4<this.stepButtons.length&&this.stepButtons[this.currentStep+4].setCurrentStep(!0))}updateCharacterState(t){this.emotionalState=t;const e=this.element.querySelector(".character-avatar"),n=this.element.querySelector(".character-status");e&&e.setAttribute("data-emotional-state",t),n&&(n.textContent=this.getStatusEmoji())}getStatusEmoji(){switch(this.emotionalState){case"sleepy":return"ðŸ’¤";case"awake":return"ðŸ˜Š";case"performing":return"ðŸŽ­";default:return"ðŸ’¤"}}}class j{container;characters;patterns;sequences;characterRows;currentStep=0;isPlaying=!1;bpm=120;stepIndicatorEventId=null;onStateChangeCallbacks=[];constructor(t){this.container=t,this.patterns=[],this.sequences=new Map,this.characterRows=new Map,this.characters=q.map((e,n)=>{const a=T(e);return a.toDestination(),{...e,synth:a,emotionalState:"sleepy",hasActiveSteps:!1}}),this.characters.forEach((e,n)=>{this.patterns.push({characterIndex:n,steps:new Array(4).fill(null).map(()=>({noteIndex:-1,pressCount:0,isActive:!1}))})})}init(){this.container.innerHTML="",this.characters.forEach((t,e)=>{const n=this.patterns[e],a=new $(t,n,s=>this.toggleStep(e,s),s=>this.currentStep===s);this.characterRows.set(e,a),this.container.appendChild(a.getElement())}),this.updateCharacterStates()}toggleStep(t,e){const n=this.characters[t],s=this.patterns[t].steps[e];this.playPreviewSound(n,s.noteIndex),n.canPitch?s.isActive?(s.noteIndex=(s.noteIndex+1)%12,s.pressCount++,s.noteIndex===0&&s.pressCount>=12&&(s.noteIndex=-1,s.isActive=!1,s.pressCount=0)):(s.noteIndex=0,s.isActive=!0,s.pressCount=1):s.isActive?(s.isActive=!1,s.noteIndex=-1,s.pressCount=0):(s.isActive=!0,s.noteIndex=0,s.pressCount=1);const r=this.characterRows.get(t);r&&r.updateStep(e,s),this.updateSequence(t),this.updateCharacterStates(),this.notifyStateChange()}playPreviewSound(t,e){if(!(!t.synth||e===-1))try{const n=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];if(t.canPitch&&e>=0){const s=`${n[e]}${t.octave}`;t.synth.triggerAttackRelease(s,"16n")}else!t.canPitch&&t.synth&&(t.type==="membrane"?t.synth.triggerAttackRelease("C1","16n"):t.synth.triggerAttackRelease("16n"))}catch(n){console.error("Preview sound error:",n)}}updateSequence(t){const e=this.characters[t],n=this.patterns[t];if(!e.synth)return;const a=this.sequences.get(t);a&&(a.stop(),a.dispose());const s=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],r=n.steps.map(i=>i.isActive?e.canPitch&&i.noteIndex>=0?`${s[i.noteIndex]}${e.octave}`:e.canPitch?null:"DRUM":null);if(!r.some(i=>i!==null)){this.sequences.delete(t);return}const c=new M((i,l)=>{if(l!==null&&e.synth)try{l==="DRUM"?e.type==="membrane"?e.synth.triggerAttackRelease("C1","4n",i):e.synth.triggerAttackRelease("4n",i):e.synth.triggerAttackRelease(l,"4n",i)}catch(d){console.error(`Error triggering ${e.name}:`,d)}},r,"4n");this.sequences.set(t,c),this.isPlaying&&c.start(0)}play(){this.isPlaying||(this.isPlaying=!0,p.start(),p.bpm.value=this.bpm,this.characters.forEach((t,e)=>{this.updateSequence(e)}),this.sequences.forEach((t,e)=>{t.state==="stopped"&&t.start(0)}),this.startStepIndicator(),this.updateCharacterStates())}pause(){this.isPlaying&&(p.pause(),this.isPlaying=!1,this.updateCharacterStates())}stop(){this.isPlaying=!1,this.sequences.forEach(t=>{t.stop(),t.dispose()}),this.sequences.clear(),p.stop(),this.currentStep=0,this.stopStepIndicator(),this.updateStepIndicator(),this.updateCharacterStates()}setBPM(t){this.bpm=t,p.bpm.value=t}isPlayingState(){return this.isPlaying}getActiveCharacterCount(){return this.characters.filter(t=>t.hasActiveSteps).length}onCharacterStateChange(t){this.onStateChangeCallbacks.push(t)}notifyStateChange(){this.onStateChangeCallbacks.forEach(t=>t())}updateCharacterStates(){this.characters.forEach((t,e)=>{const a=this.patterns[e].steps.some(r=>r.isActive);t.hasActiveSteps=a,a?this.isPlaying?t.emotionalState="performing":t.emotionalState="awake":t.emotionalState="sleepy";const s=this.characterRows.get(e);s&&s.updateCharacterState(t.emotionalState)})}startStepIndicator(){this.stepIndicatorEventId!==null&&(p.clear(this.stepIndicatorEventId),this.stepIndicatorEventId=null),this.currentStep=0,this.stepIndicatorEventId=p.scheduleRepeat(()=>{this.currentStep=(this.currentStep+1)%4,this.updateStepIndicator(),this.updateCharacterStates()},"4n",0),this.updateStepIndicator()}stopStepIndicator(){this.stepIndicatorEventId!==null&&(p.clear(this.stepIndicatorEventId),this.stepIndicatorEventId=null)}updateStepIndicator(){this.characterRows.forEach(t=>{t.updateCurrentStep(this.currentStep)})}}const S=document.getElementById("playBtn"),D=document.getElementById("stopBtn"),H=document.getElementById("bpm"),F=document.getElementById("bpmValue"),m=document.getElementById("statusText"),O=document.getElementById("characterGrid"),b=document.getElementById("celebrationModal"),u=new j(O);let E=!1;function C(){const o=u.getActiveCharacterCount();o===0?m.textContent="Click circles to wake up the characters! ðŸŽµ":o===1?m.textContent="1 character is awake! Wake up more friends! ðŸŒŸ":o<8?m.textContent=`${o} characters are awake! Keep going! ðŸŽª`:(m.textContent="ðŸŽ‰ THE WHOLE BAND IS READY! Press PLAY! ðŸŽ‰",E||(G(),E=!0))}function G(){b.style.display="flex",setTimeout(()=>{b.style.display="none"},3e3)}S.addEventListener("click",async()=>{try{R.state!=="running"&&await N(),u.isPlayingState()?(u.pause(),S.textContent="â–¶ PLAY"):(u.play(),S.textContent="â¸ PAUSE")}catch(o){m.textContent="ðŸ”‡ Oops! Can't start the music. Try clicking PLAY again!",console.error("Audio error:",o)}});D.addEventListener("click",()=>{u.stop(),S.textContent="â–¶ PLAY",C()});H.addEventListener("input",o=>{const t=parseInt(o.target.value);u.setBPM(t),F.textContent=t.toString()});u.onCharacterStateChange(()=>{C()});u.init();C();console.log("Character Orchestra initialized");
